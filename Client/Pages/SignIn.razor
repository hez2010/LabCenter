@page "/signin"
<h1>登录账户</h1>

<BFUTextField Style="width: 250px" Label="用户名" Placeholder="学号" @bind-Value="userName"></BFUTextField>
<BFUTextField Style="width: 250px" Label="密码" InputType="InputType.Password" Placeholder="初始密码与学号相同" @bind-Value="password"></BFUTextField>

<br />

<BFUPrimaryButton OnClick="SignIn_Clicked" Disabled="submitting">登录</BFUPrimaryButton>

@if (message is not null)
{
    <p style="color: red">@message</p>
}

@code {
    [CascadingParameter(Name = "SetUserInfo")] private Action<UserInfo?>? SetUserInfo { get; set; }
    [Inject] private IUserService UserService { get; set; } = default!;

    private string userName = "";
    private string password = "";
    private string? message;
    private bool submitting;

    private async Task SignIn_Clicked(MouseEventArgs args)
    {
        submitting = true;
        try
        {
            var userInfo = await UserService.SignInAsync(userName, password);
            SetUserInfo?.Invoke(userInfo);
            message = userInfo is null ? "用户名或密码不正确" : null;
        }
        finally
        {
            submitting = false;
        }
    }
}
